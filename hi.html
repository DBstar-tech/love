<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>tình yêu của anh</title>
<style>
  body { margin:0; background:black; display:flex; justify-content:center; align-items:center; height:100vh; }
  canvas { display:block; background:black; }
</style>
</head>
<body>
<canvas id="heartCanvas" width="640" height="480"></canvas>

<script>
const CANVAS_WIDTH = 640;
const CANVAS_HEIGHT = 480;
const CANVAS_CENTER_X = CANVAS_WIDTH/2;
const CANVAS_CENTER_Y = CANVAS_HEIGHT/2;
const IMAGE_ENLARGE = 11;
const HEART_COLOR = "#f76070";

// Helper functions
function heartFunction(t, scale=IMAGE_ENLARGE) {
    let x = 16 * Math.pow(Math.sin(t),3);
    let y = -(13 * Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
    x *= scale;
    y *= scale;
    x += CANVAS_CENTER_X;
    y += CANVAS_CENTER_Y;
    return [x,y];
}

function scatterInside(x,y,beta=0.15){
    let ratioX = -beta * Math.log(Math.random());
    let ratioY = -beta * Math.log(Math.random());
    let dx = ratioX*(x-CANVAS_CENTER_X);
    let dy = ratioY*(y-CANVAS_CENTER_Y);
    return [x-dx, y-dy];
}

// Build points
let points = [];
let edgePoints = [];
let centerPoints = [];
let haloPoints = [];

const NUM_POINTS = 2000;
for(let i=0;i<NUM_POINTS;i++){
    let t = Math.random()*2*Math.PI;
    let [x,y] = heartFunction(t);
    points.push({x,y});
}

// Edge diffusion
points.forEach(p=>{
    for(let i=0;i<3;i++){
        let [x,y] = scatterInside(p.x,p.y,0.05);
        edgePoints.push({x,y});
    }
});

// Center diffusion
for(let i=0;i<4000;i++){
    let p = points[Math.floor(Math.random()*points.length)];
    let [x,y] = scatterInside(p.x,p.y,0.17);
    centerPoints.push({x,y});
};

// Halo ngoài viền
const HALO_COUNT = 1000;
for(let i=0;i<HALO_COUNT;i++){
    let t = Math.random()*2*Math.PI;
    let scale = IMAGE_ENLARGE*1.1 + Math.random()*2; // xa hơn so với tim chính
    let [x,y] = heartFunction(t, scale);
    // nhỏ xíu và rải
    x += (Math.random()-0.5)*20;
    y += (Math.random()-0.5)*20;
    haloPoints.push({x,y});
}

// Combine all points
let allPoints = [...points,...edgePoints,...centerPoints,...haloPoints];

// Canvas setup
const canvas = document.getElementById("heartCanvas");
const ctx = canvas.getContext("2d");

// Draw function
let time = 0;
function draw(){
    ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);

    // nhịp tim nhẹ nhàng
    let scale = 1 + 0.05*Math.sin(time*2*Math.PI); // co dãn 5%
    let glow = 0.6 + 0.4*Math.sin(time*2*Math.PI); // lấp lánh theo nhịp
    time += 0.016;

    ctx.save();
    ctx.translate(CANVAS_CENTER_X, CANVAS_CENTER_Y);
    ctx.scale(scale,scale);
    ctx.translate(-CANVAS_CENTER_X, -CANVAS_CENTER_Y);

    // draw points chính + lấp lánh
    allPoints.forEach(p=>{
        let size = 1 + Math.random(); // lấp lánh nhẹ
        ctx.fillStyle = `rgba(247,96,112,${glow*Math.random()})`;
        ctx.fillRect(p.x, p.y, size, size);
    });

    ctx.restore();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>

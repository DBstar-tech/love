<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>tình yêu của anh</title>
<style>
  body { margin:0; background:black; display:flex; justify-content:center; align-items:center; height:100vh; }
  canvas { display:block; background:black; }
</style>
</head>
<body>
<canvas id="heartCanvas" width="640" height="480"></canvas>

<script>
const CANVAS_WIDTH = 640;
const CANVAS_HEIGHT = 480;
const CANVAS_CENTER_X = CANVAS_WIDTH/2;
const CANVAS_CENTER_Y = CANVAS_HEIGHT/2;
const IMAGE_ENLARGE = 11;

// Công thức trái tim
function heartFunction(t, scale=IMAGE_ENLARGE) {
    let x = 16 * Math.pow(Math.sin(t),3);
    let y = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
    x *= scale;
    y *= scale;
    x += CANVAS_CENTER_X;
    y += CANVAS_CENTER_Y;
    return [x,y];
}

function scatterInside(x,y,beta=0.15){
    let ratioX = -beta * Math.log(Math.random());
    let ratioY = -beta * Math.log(Math.random());
    let dx = ratioX*(x-CANVAS_CENTER_X);
    let dy = ratioY*(y-CANVAS_CENTER_Y);
    return [x-dx, y-dy];
}

// Tăng mật độ điểm gấp 3 lần
let points = [];
let edgePoints = [];
let centerPoints = [];
let haloPoints = [];

const NUM_POINTS = 6000;
for(let i=0;i<NUM_POINTS;i++){
    let t = Math.random()*2*Math.PI;
    let [x,y] = heartFunction(t);
    points.push({x,y});
}

// Edge diffusion (gấp 3)
points.forEach(p=>{
    for(let i=0;i<9;i++){
        let [x,y] = scatterInside(p.x,p.y,0.05);
        edgePoints.push({x,y});
    }
});

// Center diffusion (tăng 3 lần)
for(let i=0;i<12000;i++){
    let p = points[Math.floor(Math.random()*points.length)];
    let [x,y] = scatterInside(p.x,p.y,0.17);
    centerPoints.push({x,y});
};

// Halo ngoài viền (gấp 3)
const HALO_COUNT = 3000;
for(let i=0;i<HALO_COUNT;i++){
    let t = Math.random()*2*Math.PI;
    let scale = IMAGE_ENLARGE*1.1 + Math.random()*3;
    let [x,y] = heartFunction(t, scale);
    x += (Math.random()-0.5)*25;
    y += (Math.random()-0.5)*25;
    haloPoints.push({x,y});
}

// Tổng hợp tất cả điểm
let allPoints = [...points,...edgePoints,...centerPoints,...haloPoints];

// Canvas
const canvas = document.getElementById("heartCanvas");
const ctx = canvas.getContext("2d");

// Animation
let time = 0;
function draw(){
    ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);

    let scale = 1 + 0.05*Math.sin(time*2*Math.PI);
    let glow = 0.6 + 0.4*Math.sin(time*2*Math.PI);
    time += 0.016;

    ctx.save();
    ctx.translate(CANVAS_CENTER_X, CANVAS_CENTER_Y);
    ctx.scale(scale,scale);
    ctx.translate(-CANVAS_CENTER_X, -CANVAS_CENTER_Y);

    allPoints.forEach(p=>{
        let size = 0.8 + Math.random()*1.4;
        ctx.fillStyle = `rgba(255,80,100,${glow*Math.random()})`;
        ctx.fillRect(p.x, p.y, size, size);
    });

    ctx.restore();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
